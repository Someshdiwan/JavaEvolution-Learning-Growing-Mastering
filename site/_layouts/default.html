<!-- _layouts/default.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title | default: site.title }}</title>

    <!-- Fonts & icons -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="" crossorigin="anonymous"/>

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="{{ '/assets/favicon-96x96.png' | relative_url }}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{{ '/assets/favicon.svg' | relative_url }}" />
    <link rel="shortcut icon" href="{{ '/assets/favicon.ico' | relative_url }}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/apple-touch-icon.png' | relative_url }}" />

    <meta name="apple-mobile-web-app-title" content="JavaEvolution" />
    <link rel="manifest" href="{{ '/assets/site.webmanifest' | relative_url }}" />
    <meta name="theme-color" content="#ffffff" />

    <!-- Main stylesheet -->
    <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}" />
</head>

<body>
<!-- Theme + Time Controls -->
<div id="theme-time-container" aria-hidden="false">
    <button class="dark-toggle" aria-label="Toggle dark mode">
        <i class="fas fa-moon" aria-hidden="true"></i>
    </button>

    <div id="time-zone-wrapper">
        <button id="tz-toggle-btn" class="time-toggle" aria-label="Toggle timezone">IST</button>
        <span id="live-time" aria-live="polite">Time: Loading...</span>
    </div>
</div>

<!-- One-time Tooltip -->
<div id="tooltip" class="tooltip" role="status" aria-hidden="true">Tap an action to navigate</div>

<!-- Action rail (left column) -->
<aside id="action-rail" class="action-rail" aria-label="Quick actions">
    <a href="{{ site.baseurl }}/" class="action-btn" id="act-home" title="Home">
        <i class="fas fa-home" aria-hidden="true"></i>
        <span class="label">Home</span>
    </a>

    <a href="{{ site.baseurl }}/content" class="action-btn" id="act-content" title="All Contents">
        <i class="fas fa-book" aria-hidden="true"></i>
        <span class="label">All Contents</span>
    </a>

    <a href="https://github.com/Someshdiwan/JavaEvolution-Learning-Growing-Mastering" class="action-btn" id="act-github" title="GitHub" target="_blank" rel="noopener">
        <i class="fab fa-github" aria-hidden="true"></i>
        <span class="label">GitHub</span>
    </a>
</aside>

<!-- Main content -->
<div class="wrapper">
    <main class="content" id="main-content">
        <div class="fade-in">
            {{ content }}
        </div>
    </main>
</div>

<!-- Inline script: minimal, performant, and readable -->
<script>
    // Lightweight UI controller for dark mode, timezone, action rail active state, SW registration.
    (function () {
        // Config
        const SITE_BASE = '{{ site.baseurl }}' || '';

        // Timezone state
        let currentZone = 'IST';

        // Helpers
        const $ = (sel, ctx = document) => ctx.querySelector(sel);
        const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));

        // Update active action button based on current path
        function updateActiveLink() {
            const path = (location.pathname || '/').replace(/\/+$/, '') || '/';
            const normalized = SITE_BASE && path.startsWith(SITE_BASE) ? path.slice(SITE_BASE.length) : path;
            $$('.action-btn').forEach(btn => btn.classList.remove('active'));
            if (normalized === '/' || normalized === '' || normalized === '/index.html') {
                $('#act-home')?.classList.add('active');
            } else if (normalized.startsWith('/content')) {
                $('#act-content')?.classList.add('active');
            }
        }

        // Dark-mode toggle
        function toggleDarkMode() {
            const body = document.body;
            body.classList.toggle('dark-mode');
            const isDark = body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDark);
            const icon = $('.dark-toggle i');
            if (icon) {
                icon.classList.remove('fa-moon', 'fa-sun');
                icon.classList.add(isDark ? 'fa-sun' : 'fa-moon');
            }
        }

        // Timezone toggle
        function toggleTimezone() {
            currentZone = currentZone === 'IST' ? 'GMT' : 'IST';
            const tzButton = $('#tz-toggle-btn');
            if (tzButton) tzButton.textContent = currentZone;
            updateLiveTime();
        }

        // Live time update
        function updateLiveTime() {
            const live = $('#live-time');
            if (!live) return;
            const now = new Date();
            let date;
            if (currentZone === 'GMT') {
                date = new Date(now.getTime() + now.getTimezoneOffset() * 60000);
            } else {
                const utc = now.getTime() + now.getTimezoneOffset() * 60000;
                date = new Date(utc + 5.5 * 3600000);
            }
            let h = date.getHours();
            const m = String(date.getMinutes()).padStart(2, '0');
            const s = String(date.getSeconds()).padStart(2, '0');
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            live.textContent = `Time (${currentZone}): ${h}:${m}:${s} ${ampm}`;
        }

        // Show tooltip once
        function showTooltipOnce() {
            const t = $('#tooltip');
            if (!t) return;
            if (!localStorage.getItem('tooltip-shown-actions')) {
                setTimeout(() => {
                    t.classList.add('visible');
                    setTimeout(() => {
                        t.classList.remove('visible');
                        localStorage.setItem('tooltip-shown-actions', 'true');
                    }, 4000);
                }, 800);
            }
        }

        // Event wiring
        document.addEventListener('click', (ev) => {
            const target = ev.target;
            if (target.closest('.dark-toggle')) toggleDarkMode();
            if (target.closest('#tz-toggle-btn')) toggleTimezone();
        }, { passive: true });

        // Scroll to hide theme-time container gently
        window.addEventListener('scroll', () => {
            const theme = $('#theme-time-container');
            if (!theme) return;
            if (window.scrollY > 100) theme.classList.add('hidden');
            else theme.classList.remove('hidden');
        }, { passive: true });

        // Init on load
        window.addEventListener('load', () => {
            // Restore dark mode
            if (localStorage.getItem('dark-mode') === 'true') {
                document.body.classList.add('dark-mode');
                const icon = $('.dark-toggle i');
                if (icon) icon.classList.remove('fa-moon'), icon.classList.add('fa-sun');
            }

            updateLiveTime();
            setInterval(updateLiveTime, 1000);
            updateActiveLink();
            showTooltipOnce();

            // Register service worker (path uses Liquid to be correct for baseurl)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker
                    .register('{{ "/assets/sw.js" | relative_url }}')
                    .then(() => console.log('Service Worker Registered'))
                    .catch(err => console.error('SW registration failed', err));
            }
        });
    })();
</script>
</body>
</html>